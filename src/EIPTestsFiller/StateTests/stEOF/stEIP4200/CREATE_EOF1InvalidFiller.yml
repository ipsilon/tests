# CREATE opcode with invalid EOF1 in initcode or in deployed code
CREATE_EOF1Invalid:
  env:
    currentCoinbase: 2adc25665018aa1fe0e6bc666dac8fc2697ff9ba
    currentDifficulty: '0x020000'
    currentGasLimit: '89128960'
    currentBaseFee: '10'
    currentNumber: '1'
    currentTimestamp: '1000'
    previousHash: 5e20a0453cecd065ea59c37ac63e079ee08998b6045136a8ce6635c7912ec0b6

  pre:
    a94f5374fce5edbc8e2a8697c15331677e6ebf0b:
      balance: 200000000
      code: ''
      nonce: 0
      storage: {}
    b94f5374fce5edbc8e2a8697c15331677e6ebf0b:
      balance: 0
      code: |
        :yul 
        {
          calldatacopy(0, 0, calldatasize()) 
          sstore(0, create(0, 0, calldatasize()))
          sstore(1, 1)
        }
      nonce: 0
      storage: {}

  transaction:
    data: 
      # Legacy initcode trying to deploy invalid EOF code containing truncated RJUMP
      # Code to be deployed: RJUMP( - 0xef0001010004020001000103000000000000005c
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000103000000000000005c" }'
      # Code to be deployed: RJUMP(0 - 0xef0001010004020001000203000000000000005c00
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000203000000000000005c00" }'

      # Legacy initcode trying to deploy invalid EOF code containing RJUMP with target outside of code bounds
      # - Jump into header
      # Code to be deployed: RJUMP(-5) - 0xef0001010004020001000303000000000000005cfffb
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000303000000000000005cfffb" }'
      # - Jump before code begin
      # Code to be deployed: RJUMP(-23) - 0xef0001010004020001000303000000000000005cffe9
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000303000000000000005cffe9" }'
      # - Jump into data section
      # Code to be deployed: RJUMP(2) - Data: aabbccdd - 0xef0001010004020001000303000400000000005c0002aabbccdd
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000303000400000000005c0002aabbccdd" }'
      # - Jump after code end
      # Code to be deployed: RJUMP(2) - 0xef0001010004020001000303000000000000005c0002
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000303000000000000005c0002" }'
      # - Jump to code end
      # Code to be deployed: RJUMP(1) STOP - 0xef0001010004020001000403000000000000005c000100
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000403000000000000005c000100" }'

      # Legacy initcode trying to deploy invalid EOF code containing RJUMP with target PUSH/RJUMP/RJUMPI/RJUMPV/CALLF immediate
      # - Jump to same RJUMP Immediate
      # Code to be deployed: RJUMP(-1) - 0xef0001010004020001000303000000000000005cffff
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000303000000000000005cffff" }'
      # - Jump to another RJUMP immediate
      # Code to be deployed: RJUMP(3) STOP RJUMP(-4) - 0xef0001010004020001000703000000000000005c0003005cfffc
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000703000000000000005c0003005cfffc" }'
      # - Jump to RJUMPI immediate
      # Code to be deployed: RJUMP(5) STOP PUSH1(1) RJUMPI(-6) STOP - 0xef0001010004020001000a03000000000000015c00050060015dfffa00
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000a03000000000000015c00050060015dfffa00" }'
      # - Jump to PUSH immediate
      # Code to be deployed: RJUMP(2) NOP PUSH1(1) PUSH1(1) SSTORE STOP - 0xef0001010004020001000a03000000000000025c00025b600160015500
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000a03000000000000025c00025b600160015500" }'
      # - Jump to RJUMPV immediate
      # Code to be deployed: RJUMP(5) STOP PUSH1(1) RJUMPV(0) STOP - 0xef0001010004020001000b03000000000000015c00050060015e01000000
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000b03000000000000015c00050060015e01000000" }'
      # - Jump to CALLF immediate
      # Code to be deployed: 0xef0001010008020002000b00060300000000000000000000025c00050060015e010000006001600155b1
      #   Code[0]: RJUMP(2) CALLF(1) STOP
      #   Code[1]: PUSH1(1) PUSH1(1) SSTORE RETF
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010008020002000b00060300000000000000000000025c00050060015e010000006001600155b1" }'

      # Legacy initcode trying to deploy invalid EOF code containing truncated RJUMPI
      # Code to be deployed: PUSH1(0) RJUMPI( - 0xef00010100040200010003030000000000000160005d
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010003030000000000000160005d" }'
      # Code to be deployed: PUSH1(0) RJUMPI(0? - 0xef00010100040200010004030000000000000160005d00
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010004030000000000000160005d00" }'
      # Legacy initcode trying to deploy invalid EOF code containing RJUMPI with target outside of code bounds
      # - Jump into header
      # Code to be deployed: PUSH1(1) RJUMPI(-7) STOP - 0xef00010100040200010006030000000000000160015dfff900
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010006030000000000000160015dfff900" }'
      # - Jump to before code begin
      # Code to be deployed: PUSH1(1) RJUMPI(-25) STOP - 0xef00010100040200010006030000000000000160015dffe700
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010006030000000000000160015dffe700" }'
      # - Jump into data section
      # Code to be deployed: PUSH1(1) RJUMPI(2) STOP - Data aabbccdd - 0xef00010100040200010006030004000000000160015d000200aabbccdd
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010006030004000000000160015d000200aabbccdd" }'
      # - Jump to after code end
      # Code to be deployed: PUSH1(1) RJUMPI(2) STOP - 0xef00010100040200010006030000000000000160015d000200
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010006030000000000000160015d000200" }'
      # - Jump to code end
      # Code to be deployed: PUSH1(1) RJUMPI(1) STOP - 0xef00010100040200010006030000000000000160015d000100
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010006030000000000000160015d000100" }'
      # Legacy initcode trying to deploy invalid EOF code containing RJUMPI with target PUSH/RJUMP/RJUMPI/RJUMPV/CALLF immediate
      # - Jump to same RJUMPI immediate
      # Code to be deployed: PUSH1(1) RJUMPI(-1) STOP - 0xef00010100040200010006030000000000000160015dffff00
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010006030000000000000160015dffff00" }'
      # - Jump to another RJUMPI immediate
      # Code to be deployed: PUSH1(1) RJUMPI(5) STOP PUSH1(1) RJUMPI(-11) STOP - 0xef0001010004020001000c030000000000000160015d00050060015dfff500
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000c030000000000000160015d00050060015dfff500" }'
      # - Jump to RJUMP Immediate
      # Code to be deployed: PUSH1(1) RJUMPI(3) STOP RJUMP(-9) - 0xef00010100040200010009030000000000000160015d0003005cfff7
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010009030000000000000160015d0003005cfff7" }'
      # - Jump to PUSH Immediate
      # Code to be deployed: PUSH1(1) RJUMPI(-4) STOP - 0xef00010100040200010006030000000000000160015dfffc00
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010006030000000000000160015dfffc00" }'
      # - Jump to RJUMPV immediate
      # Code to be deployed: PUSH1(1) RJUMPI(5) STOP PUSH1(1) RJUMPV(0) STOP - 0xef0001010004020001000d030000000000000160015d00050060015e01000000
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000d030000000000000160015d00050060015e01000000" }'
      # - Jump to CALLF immediate
      # Code to be deployed: 0xef0001010008020002000d000603000000000000010000000260015d00050060015e010000006001600155b1
      #   Code[0]: PUSH1(1) RJUMPI(2) CALLF(1) STOP
      #   Code[1]: PUSH1(1) PUSH1(1) SSTORE RETF
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010008020002000d000603000000000000010000000260015d00050060015e010000006001600155b1" }'
      # Legacy Initcode trying to deploy invalid EOF code containing RJUMPV with count 0, and zero immediates
      # Code to be deployed: PUSH1(1) RJUMPI( - 0xef0001010008020002000d000603000000000000010000000260015d00050060015e010000006001600155b1
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010008020002000d000603000000000000010000000260015d00050060015e010000006001600155b1" }'
      # Legacy Initcode trying to deploy invalid EOF code containing RJUMPV with count 0, and one immediate
      # Code to be deployed: PUSH1(1) RJUMPI( - 0xef0001010008020002000d000603000000000000010000000260015d00050060015e010000006001600155b1
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010008020002000d000603000000000000010000000260015d00050060015e010000006001600155b1" }'
      # Legacy Initcode trying to deploy invalid EOF code containing truncated RJUMPV
      # Code to be deployed: PUSH1(1) RJUMP - 0xef00010100040200010003030000000000000160015e
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010003030000000000000160015e" }'
      # Code to be deployed: PUSH1(1) RJUMPV( - 0xef00010100040200010004030000000000000160015e01
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010004030000000000000160015e01" }'
      # Code to be deployed: PUSH1(1) RJUMPV(0? - 0xef00010100040200010005030000000000000160015e0100
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010005030000000000000160015e0100" }'
      # Legacy Initcode trying to deploy invalid EOF code containing RJUMPV with target outside of code bounds
      # - Jump into header
      # Code to be deployed: PUSH1(1) RJUMPV(-7) STOP - 0xef00010100040200010007030000000000000160015e01fff900
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010007030000000000000160015e01fff900" }'
      # - Jump to before code begin
      # Code to be deployed: PUSH1(1) RJUMPV(-15) STOP - 0xef00010100040200010007030000000000000160015e01fff100
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010007030000000000000160015e01fff100" }'
      # - Jump into data section
      # Code to be deployed: PUSH1(1) RJUMPV(2) STOP - Data: aabbccdd - 0xef00010100040200010007030004000000000160015e01000200aabbccdd
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010007030004000000000160015e01000200aabbccdd" }'
      # - Jump to after code end
      # Code to be deployed: PUSH1(1) RJUMPV(2) STOP - 0xef00010100040200010007030000000000000160015e01000200
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010007030000000000000160015e01000200" }'
      # - Jump to code end
      # Code to be deployed: PUSH1(1) RJUMPV(1) STOP - 0xef00010100040200010007030000000000000160015e01000100
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010007030000000000000160015e01000100" }'
      # Legacy Initcode trying to deploy invalid EOF code containing RJUMPV with target PUSH/RJUMP/RJUMPI/RJUMPV's immediate
      # - Jump to same RJUMPV Immediate
      # Code to be deployed: PUSH1(1) RJUMPV(-1) STOP - 0xef00010100040200010007030000000000000160015e01ffff00
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef00010100040200010007030000000000000160015e01ffff00" }'
      # - Jump to RJUMPI immediate
      # Code to be deployed: PUSH1(1) RJUMPV(5) STOP PUSH1(1) RJUMPI(-9) STOP - 0xef0001010004020001000d030000000000000160015e0100050060015dfff700
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000d030000000000000160015e0100050060015dfff700" }'
      # - Jump to RJUMP immediate
      # Code to be deployed: PUSH1(1) RJUMPV(5) STOP PUSH1(1) RJUMP(-9) STOP - ef0001010004020001000d030000000000000160015e0100050060015cfff700
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000d030000000000000160015e0100050060015cfff700" }'
      # - Jump to PUSH immediate
      # Code to be deployed: PUSH1(1) RJUMPV(2) STOP PUSH1(1) PUSH1(1) SSTORE STOP - 0xef0001010004020001000d030000000000000260015e01000200600160015500
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000d030000000000000260015e01000200600160015500" }'
      # - Jump to other RJUMPV immediate
      # Code to be deployed: PUSH1(1) RJUMPV(5) STOP PUSH1(1) RJUMPV(0) STOP - 0xef0001010004020001000e030000000000000160015e0100050060015e01000000
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010004020001000e030000000000000160015e0100050060015e01000000" }'
      # - Jump to CALLF immediate
      # Code to be deployed: 0xef0001010008020002000e000603000000000000020000000260015e0100050060015e010000006001600155b1
      #   Code[0]: PUSH1(0) RJUMPV(2) CALLF(1) STOP
      #   Code[1]: PUSH1(1) PUSH1(1) SSTORE RETF
      - ':yul object "c" { code { datacopy(0, dataoffset("r"), datasize("r")) return(0, datasize("r")) } data "r" hex"ef0001010008020002000e000603000000000000020000000260015e0100050060015e010000006001600155b1" }'
    gasLimit:
      - 15000000
    gasPrice: 10
    nonce: 0
    secretKey: 45a915e4d060149eb4365960e6a7a45f334393093061116b197e3240065ff2d8
    to: 'b94f5374fce5edbc8e2a8697c15331677e6ebf0b'
    value:
      - 0

  expect:
    - indexes: {}
      network:
        - 'Shanghai'
      result:
       a94f5374fce5edbc8e2a8697c15331677e6ebf0b:
          nonce: 1
       b94f5374fce5edbc8e2a8697c15331677e6ebf0b:
          nonce: '1'
          storage:
            '0': '0'
            '1': '1'
       f1ecf98489fa9ed60a664fc4998db699cfa39d40:
          shouldnotexist: 1
    
    # Same expectation, but for Shanghai execution fails on EF byte, for >=Cancun it fails because EOF code is invalid
    - indexes: {}
      network:
        - '>=Cancun'
      result:
       a94f5374fce5edbc8e2a8697c15331677e6ebf0b:
          nonce: 1
       b94f5374fce5edbc8e2a8697c15331677e6ebf0b:
          nonce: '1'
          storage:
            '0': '0'
            '1': '1'
       f1ecf98489fa9ed60a664fc4998db699cfa39d40:
          shouldnotexist: 1
